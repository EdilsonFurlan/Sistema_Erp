{% extends 'base.html' %}

{% block title %}Planejamento de Compras{% endblock %}

{% block extra_head %}
    <style>
        .container { background: white; padding: 25px; border-radius: 8px; max-width: 1000px; margin: auto; box-shadow: 0 2px 15px rgba(0,0,0,0.05); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .actions { margin-bottom: 20px; text-align: right; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; color: #666; font-weight: 600; }
        
        tr:hover { background-color: #f1f1f1; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-pending { background: #ffeeba; color: #856404; }
        .badge-purchased { background: #d4edda; color: #155724; }
        
        .btn { display: inline-block; padding: 10px 20px; border: none; border-radius: 4px; font-size: 14px; cursor: pointer; text-decoration: none; font-weight: bold; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        
        .btn-secondary { background: #95a5a6; color: white; }
        
        .selection-summary { margin-top: 20px; padding: 15px; background: #e8f4f8; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="top-bar">
            <h1>Planejamento de Compras (OC)</h1>
            <a href="{% url 'order_list' %}" class="btn btn-secondary">Voltar aos Pedidos</a>
        </div>
        
        <form action="{% url 'visualize_purchase_creation' %}" method="POST">
            {% csrf_token %}
            
            <table>
                <thead>
                    <tr>
                        <th width="40"><input type="checkbox" id="selectAll"></th>
                        <th>Pedido</th>
                        <th>Cliente</th>
                        <th>Data</th>
                        <th>Status Compra</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>
                            <input type="checkbox" name="selected_orders" value="{{ order.id }}" class="order-checkbox">
                        </td>
                        <td>#{{ order.id }}</td>
                        <td>{{ order.cliente }}</td>
                        <td>{{ order.data|date:"d/m/Y" }}</td>
                        <td>
                            {% if order.ordens_compra.exists %}
                                {% for oc in order.ordens_compra.all %}
                                    <span class="badge badge-purchased">OC #{{ oc.id }}</span>
                                {% endfor %}
                            {% else %}
                                <span class="badge badge-pending">Pendente</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'order_detail' order.id %}" target="_blank" style="color:#3498db; font-size:0.9em;">Ver Detalhes</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align:center; padding:30px;">Nenhum pedido encontrado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div class="selection-summary">
                <div>
                    Selecione os pedidos que deseja agrupar para compra de materiais.
                </div>
                <button type="submit" class="btn btn-primary">Gerar Ordem de Compra</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('selectAll').addEventListener('change', function() {
            var checkboxes = document.querySelectorAll('.order-checkbox');
            for (var checkbox of checkboxes) {
                checkbox.checked = this.checked;
            }
        });
    </script>
{% endblock %}
